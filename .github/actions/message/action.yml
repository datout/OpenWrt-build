name: 'My Composite Action'
description: 'Combines multiple steps'
runs:
  using: "composite"
  steps:
    - name: 鍏憡
      if: env.SendMessage != 'true'
      shell: bash
      run: |
        cd "$HOME_PATH"
        echo -e "\n\033[0;33m绗竴娆＄敤鎴戜粨搴撶殑锛岃涓嶈鎷夊彇浠讳綍鎻掍欢锛屽厛SSH杩涘叆鍥轰欢閰嶇疆閭ｉ噷鐪嬭繃鎴戣剼鏈疄鍦ㄦ槸娌℃湁浣犺鐨勬彃浠舵墠鍐嶆媺鍙朶033[0m"
        echo -e "\n\033[0;33m鎷夊彇鎻掍欢搴旇鍗曠嫭鎷夊彇鏌愪竴涓綘闇€瑕佺殑鎻掍欢锛屽埆涓€涓嬪瓙灏辨媺鍙栧埆浜轰竴涓彃浠跺寘锛岃繖鏍峰鏄撳鍔犵紪璇戝け璐ユ鐜嘰033[0m"
        if [[ "${UPDATE_FIRMWARE_ONLINE}" == "true" ]]; then
           echo -e "\n\033[0;31mSSH杩炴帴鍥轰欢杈撳叆鍛戒护'openwrt'鍙繘琛屼慨鏀瑰悗鍙癐P銆佹竻绌哄瘑鐮併€佽繕鍘熷嚭鍘傝缃拰鍦ㄧ嚎鏇存柊鍥轰欢鎿嶄綔\033[0m"
        else
           echo -e "\n\033[0;31mSSH杩炴帴鍥轰欢杈撳叆鍛戒护'openwrt'鍙繘琛屼慨鏀瑰悗鍙癐P锛屾竻绌哄瘑鐮佸拰杩樺師鍑哄巶璁剧疆鎿嶄綔\033[0m"
        fi
        echo

    - name: 缂栬瘧淇℃伅
      if: env.SendMessage == 'true'
      shell: bash
      run: |
        cd "$HOME_PATH"
        # 澶嶇敤棰滆壊杈撳嚭鍑芥暟
        function TIME() {
          case "$1" in
             r) local Color="\033[0;31m";;
             g) local Color="\033[0;32m";;
             y) local Color="\033[0;33m";;
             b) local Color="\033[0;34m";;
             z) local Color="\033[0;35m";;
             l) local Color="\033[0;36m";;
             *) local Color="\033[0;0m";;
          esac
        echo -e "${Color}${2}\033[0m"
        }

        # 鎻愬彇鎻掍欢淇℃伅
        OUTPUT_FILE="/tmp/CONFIG_PACKAGE"
        > "$OUTPUT_FILE"
        counter=1
        grep -E '^CONFIG_PACKAGE_luci-(app|theme)-[^_]+=y$' "$HOME_PATH/.config" | while IFS='=' read -r line _; do
           package_name="${line#CONFIG_PACKAGE_}"
           echo "TIME g \"$counter銆?package_name\" |sed 's/^/         /'" >> "$OUTPUT_FILE"
           counter=$((counter + 1))
        done

        echo
        TIME b "缂栬瘧婧愮爜: ${SOURCE}"
        TIME b "婧愮爜閾炬帴: ${REPO_URL}"
        TIME b "婧愮爜鍒嗘敮: ${REPO_BRANCH}"
        TIME b "婧愮爜浣滆€? ${SOURCE_OWNER}"
        TIME b "Luci鐗堟湰: ${LUCI_EDITION}"
        if [[ "${TARGET_BOARD}" =~ (armvirt|armsr) ]]; then
           TIME b "缂栬瘧鏈哄瀷: armsr_rootfs_tar_gz"
           if [[ "${PACKAGING_FIRMWARE}" == "true" ]]; then
              TIME g "鎵撳寘鏈哄瀷: ${amlogic_model}"
              TIME g "鎵撳寘鍐呮牳: ${amlogic_kernel}"
              TIME g "鍒嗗尯鏁版嵁: ${openwrt_size}"
              if [[ "${auto_kernel}" == "true" ]]; then
                 TIME g "鑷姩妫€娴嬫渶鏂板唴鏍? 鏄?
               else
                 TIME g "鑷姩妫€娴嬫渶鏂板唴鏍? 涓嶆槸"
               fi
           else
             TIME b "鍐呮牳鐗堟湰: ${LINUX_KERNEL}"
             TIME r "鑷姩鎵撳寘: 娌″紑鍚嚜鍔ㄦ墦鍖呰缃?
          fi
        else
           TIME b "鍐呮牳鐗堟湰: ${LINUX_KERNEL}"
           TIME b "缂栬瘧鏈哄瀷: ${TARGET_PROFILE}"
        fi
        TIME b "鍥轰欢浣滆€? ${GIT_ACTOR}"
        TIME b "浠撳簱鍦板潃: ${GITHUB_LINK}"
        if [[ -n "${ERRUN_NUMBER}" ]]; then
           TIME b "鍚姩缂栧彿: 姝ゅ伐浣滄祦绋嬬敱[#${ERRUN_NUMBER}鍙?{{github.workflow}}]瑙﹀彂鍚姩,鏈伐浣滄祦绋嬬紪鍙穂${WAREHOUSE_MAN}浠撳簱#${RUN_NUMBER}鍙穄锛?
        else
           TIME b "鍚姩缂栧彿: #${RUN_NUMBER}锛?{WAREHOUSE_MAN}浠撳簱绗?{RUN_NUMBER}娆″惎鍔╗${{github.workflow}}]宸ヤ綔娴佺▼锛?
        fi
        TIME b "缂栬瘧鏃堕棿: $(date +%Y骞?m鏈?d鍙?H鏃?M鍒?"
        if [[ "${SOURCE_CODE}" == "AMLOGIC" && "${PACKAGING_FIRMWARE}" == "true" ]]; then
           TIME g "鍙嬫儏鎻愮ず锛氭偍褰撳墠浣跨敤銆?{FOLDER_NAME}銆戞枃浠跺す缂栬瘧銆?{amlogic_model}銆戝浐浠?
        else
           TIME g "鍙嬫儏鎻愮ず锛氭偍褰撳墠浣跨敤銆?{FOLDER_NAME}銆戞枃浠跺す缂栬瘧銆?{TARGET_PROFILE}銆戝浐浠?
        fi
        echo
        echo
        if [[ ${INFORMATION_NOTICE} == "TG" || ${INFORMATION_NOTICE} == "PUSH" ]]; then
           TIME y "pushplus/Telegram閫氱煡: 寮€鍚?
        else
           TIME r "pushplus/Telegram閫氱煡: 鍏抽棴"
        fi
        if [[ ${UPLOAD_FIRMWARE} == "true" ]]; then
           TIME y "涓婁紶鍥轰欢鍦╣ithub actions: 寮€鍚?
        else
           TIME r "涓婁紶鍥轰欢鍦╣ithub actions: 鍏抽棴"
        fi
        if [[ ${UPLOAD_RELEASE} == "true" ]]; then
           TIME y "鍙戝竷鍥轰欢(Release): 寮€鍚?
        else
           TIME r "鍙戝竷鍥轰欢(Release): 鍏抽棴"
        fi
        if [[ ${CACHEWRTBUILD_SWITCH} == "true" ]]; then
           TIME y "鏄惁寮€鍚紦瀛樺姞閫? 寮€鍚?
        else
           TIME r "鏄惁寮€鍚紦瀛樺姞閫? 鍏抽棴"
        fi
        if [[ ${COMPILATION_INFORMATION} == "true" ]]; then
           TIME y "缂栬瘧淇℃伅鏄剧ず: 寮€鍚?
        fi
        if [[ "${TARGET_BOARD}" =~ (armvirt|armsr) ]]; then
           if [[ ${PACKAGING_FIRMWARE} == "true" ]]; then
              TIME y "armsr_rootfs_tar_gz鍥轰欢鑷姩鎵撳寘鎴?.img 鍥轰欢: 寮€鍚?
           else
              TIME r "armsr_rootfs_tar_gz鍥轰欢鑷姩鎵撳寘鎴?.img 鍥轰欢: 鍏抽棴"
           fi
        else
           if [[ ${UPDATE_FIRMWARE_ONLINE} == "true" ]]; then
              TIME y "鎶婂畾鏃惰嚜鍔ㄦ洿鏂版彃浠剁紪璇戣繘鍥轰欢: 寮€鍚?
           else
              TIME r "鎶婂畾鏃惰嚜鍔ㄦ洿鏂版彃浠剁紪璇戣繘鍥轰欢: 鍏抽棴"
           fi
        fi
        if [[ "${UPDATE_FIRMWARE_ONLINE}" == "true" ]]; then
           echo
           TIME l "瀹氭椂鑷姩鏇存柊淇℃伅"
           TIME z "鎻掍欢鐗堟湰: ${AUTOUPDATE_VERSION}"
           if [[ ${TARGET_BOARD} == "x86" ]]; then
              TIME b "鍥轰欢鍚嶇О: ${AUTOBUILD_FIRMWARE}${FIRMWARE_SUFFIX}"
              grep -q "CONFIG_GRUB_EFI_IMAGES=y" "$HOME_PATH/.config" && TIME b "UEFI鍥轰欢: ${AUTOBUILD_FIRMWARE_UEFI}${FIRMWARE_SUFFIX}"
           else
              TIME b "鍥轰欢鍚嶇О: ${AUTOBUILD_FIRMWARE}${FIRMWARE_SUFFIX}"
           fi
           TIME b "鍥轰欢鍚庣紑: ${FIRMWARE_SUFFIX}"
           TIME b "鍥轰欢鐗堟湰: ${FIRMWARE_VERSION}"
           TIME b "浜戠璺緞: ${GITHUB_RELEASE}"
           TIME g "銆婄紪璇戞垚鍔熷悗锛屼細鑷姩鎶婂浐浠跺彂甯冨埌鎸囧畾鍦板潃锛岀劧鍚庢墠浼氱敓鎴愪簯绔矾寰勩€?
           TIME g "銆婃櫘閫氱殑閭ｄ釜鍙戝竷鍥轰欢璺熶簯绔殑鍙戝竷璺緞鏄袱鐮佷簨锛屽鏋滀綘涓嶉渶瑕佹櫘閫氬彂甯冪殑鍙互涓嶇敤鎵撳紑鍙戝竷鍔熻兘銆?
           TIME g "淇敼IP銆丏NS銆佺綉鍏虫垨鑰呭湪绾挎洿鏂帮紝璇疯緭鍏ュ懡浠わ細openwrt"
           echo
        else
           echo
        fi
        echo
        TIME z " 绯荤粺绌洪棿      绫诲瀷   鎬绘暟  宸茬敤  鍙敤 浣跨敤鐜?
        df -hT "$PWD"

        if [ -f "/tmp/CONFIG_PACKAGE" ]; then
           echo
           echo
           TIME r "	      宸查€夋彃浠跺垪琛?
           chmod -R +x "/tmp/CONFIG_PACKAGE"
           . "/tmp/CONFIG_PACKAGE"
           rm -f "/tmp/CONFIG_PACKAGE"
           echo
        fi
branding:
  icon: "terminal"
  color: "gray-dark"
